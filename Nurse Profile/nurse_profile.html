<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Profile  Nurse</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="sidebar">
  <div class="logo"> e-learn<small>Health Services Module</small></div>
  <div class="menu">
    <div class="menu-title">Profile</div>
    <a href="nurse_profile.html" class="active">ğŸ‘¤ My Profile</a>
    <div class="menu-title">Health Services</div>
    <a href="nurse_dashboard.html">ğŸ“Š Dashboard</a>
    <a href="nurse_records.html">ğŸ“‹ Health Records</a>
    <a href="nurse_inventory.html">ğŸ’Š Medicine Inventory</a>
    <a href="nurse_dispensing.html">ğŸ“¦ Dispensing Log</a>
    <a href="nurse_patient_profiles.html">ğŸ§‘â€âš•ï¸ Patient Profiles</a>
    <a href="nurse_consultations.html">ğŸ—“ Consultations</a>
  </div>
</div>

<div class="main">
  <div class="header">
    <div>
      <h2>ğŸ‘¤ My Profile</h2>
      <div style="font-size:13px;color:#6b7280;">Manage your account and view activity</div>
    </div>
    <div class="header-right">
      <div class="nurse-name" id="headerName">Ana Lopez</div>
      <div class="nurse-role">School Nurse</div>
      <button class="logout-btn" onclick="location.href='login.html'">Logout</button>
    </div>
  </div>

  <div class="content">
    <div class="wrap">

      <!-- LEFT: PROFILE CARD -->
      <div class="pcard">
        <div class="pcard-top">
          <div class="avatar" id="avatar">AL</div>
          <div class="pname" id="displayName">Ana Lopez</div>
          <div class="prole">School Nurse</div>
        </div>

        <div class="pbody">

          <!-- VIEW MODE -->
          <div id="viewMode">
            <div class="section-title" style="color:#0f6b5e;border-color:#a7f3d0;">Account Information</div>
            <div class="prow"><div class="picon">ğŸªª</div><div><div class="plbl">Employee ID</div><div class="pval" id="v-empid">â€”</div></div></div>
            <div class="prow"><div class="picon">âœ‰ï¸</div><div><div class="plbl">Email</div><div class="pval" id="v-email">â€”</div></div></div>
            <div class="prow"><div class="picon">ğŸ“±</div><div><div class="plbl">Contact</div><div class="pval" id="v-contact">â€”</div></div></div>
            <div class="prow"><div class="picon">ğŸ¥</div><div><div class="plbl">Department</div><div class="pval" id="v-dept">â€”</div></div></div>
            <div class="prow"><div class="picon">ğŸ“</div><div><div class="plbl">Clinic Location</div><div class="pval" id="v-office">â€”</div></div></div>
            <div class="prow"><div class="picon">ğŸ•</div><div><div class="plbl">Clinic Hours</div><div class="pval" id="v-hours">â€”</div></div></div>
            <div class="prow"><div class="picon">ğŸ“</div><div><div class="plbl">License No.</div><div class="pval" id="v-license">â€”</div></div></div>
            <div class="prow"><div class="picon">ğŸ‘¤</div><div><div class="plbl">Username</div><div class="pval" id="v-user">â€”</div></div></div>
            <div class="prow">
              <div class="picon">ğŸ”˜</div>
              <div><div class="plbl">Status</div>
                <div class="pval"><span class="sdot active" id="sdot"></span><span id="v-status">Active</span></div>
              </div>
            </div>
            <div style="display:flex;gap:8px;margin-top:16px;flex-wrap:wrap;">
              <button class="btn sm" onclick="enterEdit()">Edit</button>
              <button class="btn sm outline" onclick="togglePw()">Change Password</button>
            </div>
            <!-- Change PW -->
            <div class="cpw" id="cpwSec">
              <h4>ğŸ” Change Password</h4>
              <input type="password" id="pw-cur" placeholder="Current password">
              <input type="password" id="pw-new" placeholder="New password">
              <input type="password" id="pw-cfm" placeholder="Confirm new password">
              <div style="display:flex;gap:8px;">
                <button class="btn sm" onclick="savePw()">Save Password</button>
                <button class="btn sm outline" onclick="togglePw()">Cancel</button>
              </div>
            </div>
          </div>

          <!-- EDIT MODE -->
          <div id="editMode" style="display:none;">
            <div class="section-title" style="color:#0f6b5e;border-color:#a7f3d0;">Edit Information</div>
            <div class="ef"><label>Full Name</label><input type="text" id="e-name"></div>
            <div class="ef"><label>Employee ID</label><input type="text" id="e-empid"></div>
            <div class="ef"><label>Email</label><input type="text" id="e-email"></div>
            <div class="ef"><label>Contact</label><input type="text" id="e-contact"></div>
            <div class="ef"><label>Department</label><input type="text" id="e-dept"></div>
            <div class="ef"><label>Clinic Location</label><input type="text" id="e-office"></div>
            <div class="ef"><label>Clinic Hours</label><input type="text" id="e-hours" placeholder="e.g. 7:00 AM â€“ 4:00 PM"></div>
            <div class="ef"><label>License No.</label><input type="text" id="e-license" placeholder="e.g. RN-12345"></div>
            <div class="ef"><label>Username</label><input type="text" id="e-user"></div>
            <div class="ef">
              <label>Status</label>
              <select id="e-status"><option value="Active">Active</option><option value="Inactive">Inactive</option></select>
            </div>
            <div style="display:flex;gap:8px;margin-top:14px;">
              <button class="btn sm" onclick="saveProfile()">Save Changes</button>
              <button class="btn sm outline" onclick="cancelEdit()">Cancel</button>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="rCol">

        <!-- Activity Summary -->
        <div>
          <div class="section-title" style="color:#0f6b5e;border-color:#a7f3d0;">Activity Summary</div>
          <div class="sumGrid">
            <div class="sbox"><div class="si">ğŸ“‹</div><div class="sc" id="sm-records">0</div><div class="sl">Records Added</div></div>
            <div class="sbox"><div class="si">ğŸ“¦</div><div class="sc" id="sm-dispense">0</div><div class="sl">Medicines Dispensed</div></div>
            <div class="sbox"><div class="si">ğŸ’Š</div><div class="sc" id="sm-inv">0</div><div class="sl">Inventory Actions</div></div>
            <div class="sbox"><div class="si">ğŸ§‘â€âš•ï¸</div><div class="sc" id="sm-profile">0</div><div class="sl">Profiles Added</div></div>
            <div class="sbox"><div class="si">ğŸ—“</div><div class="sc" id="sm-consult">0</div><div class="sl">Consultations</div></div>
            <div class="sbox"><div class="si">ğŸ“Œ</div><div class="sc" id="sm-total">0</div><div class="sl">Total Actions</div></div>
          </div>
        </div>

        <!-- Activity Log -->
        <div class="logCard">
          <h3>ğŸ• Recent Activity Log</h3>
          <div id="logWrap"><div class="empty-note">No activity recorded yet.</div></div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
/* ---- DEFAULT ---- */
var DEFAULT = {
  name:'Ana Lopez', empid:'NRS-001', email:'nurse@school.edu',
  contact:'09XX-XXX-XXXX', dept:'Health Services',
  office:'Main Building â€“ Clinic Room', hours:'7:00 AM â€“ 4:00 PM',
  license:'RN-00000', username:'alopeznurse', status:'Active'
};

var profile = JSON.parse(localStorage.getItem('nurseProfile')) || DEFAULT;

/* ---- HELPERS ---- */
function initials(n) {
  return (n || '').split(' ').filter(function(w){ return /[A-Za-z]/.test(w); })
    .map(function(w){ return w[0]; }).slice(0,2).join('').toUpperCase();
}

function log(type, msg) {
  var logs = JSON.parse(localStorage.getItem('nurseActivity')) || [];
  logs.unshift({ type: type, msg: msg, time: new Date().toISOString() });
  localStorage.setItem('nurseActivity', JSON.stringify(logs.slice(0, 50)));
}

function timeAgo(iso) {
  var s = Math.floor((Date.now() - new Date(iso)) / 1000);
  if (s < 60)    return 'Just now';
  if (s < 3600)  return Math.floor(s/60) + ' min ago';
  if (s < 86400) return Math.floor(s/3600) + ' hr ago';
  return Math.floor(s/86400) + ' day(s) ago';
}

/* ---- RENDER ---- */
function renderProfile() {
  document.getElementById('headerName').textContent  = profile.name;
  document.getElementById('displayName').textContent = profile.name;
  document.getElementById('avatar').textContent      = initials(profile.name);
  document.getElementById('v-empid').textContent     = profile.empid    || 'â€”';
  document.getElementById('v-email').textContent     = profile.email    || 'â€”';
  document.getElementById('v-contact').textContent   = profile.contact  || 'â€”';
  document.getElementById('v-dept').textContent      = profile.dept     || 'â€”';
  document.getElementById('v-office').textContent    = profile.office   || 'â€”';
  document.getElementById('v-hours').textContent     = profile.hours    || 'â€”';
  document.getElementById('v-license').textContent   = profile.license  || 'â€”';
  document.getElementById('v-user').textContent      = profile.username || 'â€”';
  document.getElementById('v-status').textContent    = profile.status   || 'Active';
  var active = profile.status !== 'Inactive';
  document.getElementById('sdot').className = 'sdot ' + (active ? 'active' : 'inactive');
}

/* ---- EDIT ---- */
function enterEdit() {
  document.getElementById('e-name').value    = profile.name;
  document.getElementById('e-empid').value   = profile.empid    || '';
  document.getElementById('e-email').value   = profile.email    || '';
  document.getElementById('e-contact').value = profile.contact  || '';
  document.getElementById('e-dept').value    = profile.dept     || '';
  document.getElementById('e-office').value  = profile.office   || '';
  document.getElementById('e-hours').value   = profile.hours    || '';
  document.getElementById('e-license').value = profile.license  || '';
  document.getElementById('e-user').value    = profile.username || '';
  document.getElementById('e-status').value  = profile.status   || 'Active';
  document.querySelectorAll('.ef').forEach(function(el){ el.style.display='flex'; });
  document.getElementById('viewMode').style.display = 'none';
  document.getElementById('editMode').style.display = 'block';
}

function cancelEdit() {
  document.getElementById('editMode').style.display = 'none';
  document.getElementById('viewMode').style.display = 'block';
}

function saveProfile() {
  var name = document.getElementById('e-name').value.trim();
  if (!name) { alert('Name cannot be empty.'); return; }
  profile.name     = name;
  profile.empid    = document.getElementById('e-empid').value.trim();
  profile.email    = document.getElementById('e-email').value.trim();
  profile.contact  = document.getElementById('e-contact').value.trim();
  profile.dept     = document.getElementById('e-dept').value.trim();
  profile.office   = document.getElementById('e-office').value.trim();
  profile.hours    = document.getElementById('e-hours').value.trim();
  profile.license  = document.getElementById('e-license').value.trim();
  profile.username = document.getElementById('e-user').value.trim();
  profile.status   = document.getElementById('e-status').value;
  localStorage.setItem('nurseProfile', JSON.stringify(profile));
  log('edit', 'Updated profile information');
  renderProfile();
  cancelEdit();
  alert('Profile saved!');
}

/* ---- CHANGE PW ---- */
function togglePw() {
  var sec = document.getElementById('cpwSec');
  sec.classList.toggle('on');
  if (!sec.classList.contains('on')) {
    ['pw-cur','pw-new','pw-cfm'].forEach(function(id){ document.getElementById(id).value=''; });
  }
}

function savePw() {
  var cur  = document.getElementById('pw-cur').value;
  var nw   = document.getElementById('pw-new').value;
  var cfm  = document.getElementById('pw-cfm').value;
  if (!cur || !nw || !cfm)  { alert('Fill in all password fields.'); return; }
  if (nw !== cfm)            { alert('New password and confirmation do not match.'); return; }
  if (nw.length < 6)         { alert('Password must be at least 6 characters.'); return; }
  localStorage.setItem('nursePw', nw);
  log('edit', 'Changed account password');
  togglePw();
  alert('Password changed successfully!');
}

/* ---- ACTIVITY ---- */
function renderLog() {
  var logs = JSON.parse(localStorage.getItem('nurseActivity')) || [];
  var wrap = document.getElementById('logWrap');
  if (!logs.length) { wrap.innerHTML = '<div class="empty-note">No activity recorded yet.</div>'; return; }
  wrap.innerHTML = logs.slice(0, 15).map(function(l) {
    return '<div class="li">'
         + '<div class="ldot ' + (l.type || 'edit') + '"></div>'
         + '<div style="flex:1;">'
         + '<div class="lact">' + l.msg + '</div>'
         + '<div class="ltm">' + timeAgo(l.time) + ' Â· ' + new Date(l.time).toLocaleString() + '</div>'
         + '</div></div>';
  }).join('');
}

function renderSummary() {
  var logs = JSON.parse(localStorage.getItem('nurseActivity')) || [];
  document.getElementById('sm-records').textContent = logs.filter(function(l){ return l.type==='record'; }).length;
  document.getElementById('sm-dispense').textContent= logs.filter(function(l){ return l.type==='dispense'; }).length;
  document.getElementById('sm-inv').textContent     = logs.filter(function(l){ return l.type==='inventory'; }).length;
  document.getElementById('sm-profile').textContent = logs.filter(function(l){ return l.type==='profile'; }).length;
  document.getElementById('sm-consult').textContent = logs.filter(function(l){ return l.type==='consult'; }).length;
  document.getElementById('sm-total').textContent   = logs.length;
}

/* ---- INIT ---- */
if (!sessionStorage.getItem('nurseVisited')) {
  sessionStorage.setItem('nurseVisited', '1');
  log('login', 'Logged in as ' + profile.name);
}

renderProfile();
renderLog();
renderSummary();
setInterval(function(){ renderLog(); renderSummary(); }, 10000);
window.addEventListener('storage', function(){ renderLog(); renderSummary(); });
</script>
</body>
</html>